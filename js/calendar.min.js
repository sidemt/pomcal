var DISCOVERY_DOCS=["https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest"],SCOPES="https://www.googleapis.com/auth/calendar",authorizeDesc=document.getElementById("authorize_desc"),authorizeButton=document.getElementById("authorize_button"),signoutButton=document.getElementById("signout_button"),createButton=document.getElementById("create_button"),signedInOnly=document.getElementById("signed-in-only"),noLogs=document.getElementById("no-logs");function handleClientLoad(){gapi.load("client:auth2",initClient)}function initClient(){gapi.client.init({apiKey:API_KEY,clientId:CLIENT_ID,discoveryDocs:DISCOVERY_DOCS,scope:SCOPES}).then(function(){gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus),updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get()),authorizeButton.onclick=handleAuthClick,signoutButton.onclick=handleSignoutClick,createButton.onclick=handleCreateClick})}function updateSigninStatus(e){e?(authorizeDesc.style.display="none",authorizeButton.style.display="none",signoutButton.style.display="inline",signedInOnly.style.display="block",clearOption(),getCalendarList()):(authorizeDesc.style.display="block",authorizeButton.style.display="inline",signoutButton.style.display="none",signedInOnly.style.display="none")}function handleAuthClick(e){gapi.auth2.getAuthInstance().signIn()}function handleSignoutClick(e){gapi.auth2.getAuthInstance().signOut()}function handleCreateClick(e){createEvent(parseInt(document.getElementById("session-length").innerText,10),document.getElementById("current-event-name").innerText,document.getElementById("current-event-desc").innerText,document.getElementById("calendar-select").value)}function appendOl(e){"none"!=noLogs.style.display&&(noLogs.style.display="none");var t="<li>"+e+"</li>";document.getElementById("event-list").insertAdjacentHTML("beforeEnd",t)}function appendOption(e,t,n){if(n)var i='<option value="'+e+'" selected>'+t+"</option>";else i='<option value="'+e+'">'+t+"</option>";document.getElementById("calendar-select").insertAdjacentHTML("beforeEnd",i)}function clearOption(){document.getElementById("calendar-select").innerHTML=""}function listUpcomingEvents(){gapi.client.calendar.events.list({calendarId:"primary",timeMin:(new Date).toISOString(),showDeleted:!1,singleEvents:!0,maxResults:10,orderBy:"startTime"}).then(function(e){var t=e.result.items;if(appendPre("Upcoming events:"),t.length>0)for(i=0;i<t.length;i++){var n=t[i],a=n.start.dateTime;a||(a=n.start.date),appendPre(n.summary+" ("+a+")")}else appendPre("No upcoming events found.")})}function rfc3339(e){function t(e){return e<10?"0"+e:e}return e.getFullYear()+"-"+t(e.getMonth()+1)+"-"+t(e.getDate())+"T"+t(e.getHours())+":"+t(e.getMinutes())+":"+t(e.getSeconds())+(0===(n=e.getTimezoneOffset())?"Z":(i=n>0?"-":"+",n=Math.abs(n),i+t(Math.floor(n/60))+":"+t(n%60)));var n,i}function createEvent(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Pomodoro",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"primary";if(gapi.auth2.getAuthInstance().isSignedIn.get()){var a=new Date,o=new Date;a.setMinutes(a.getMinutes()-e);var l={summary:t,start:{dateTime:a=rfc3339(a)},end:{dateTime:o=rfc3339(o)},description:n};gapi.client.calendar.events.insert({calendarId:i,resource:l}).execute(function(e){console.log(e),appendOl("Pomodoro Done: "+e.summary+' <a href="'+e.htmlLink+'" target="_blank">[View in Calendar]</a>')})}else{console.log("Not signed in");appendOl("Pomodoro Done: Not Signed In")}}function getCalendarList(){gapi.auth2.getAuthInstance().isSignedIn.get()?gapi.client.calendar.calendarList.list({minAccessRole:"writer"}).execute(function(e){e.items.forEach(function(e){appendOption(e.id,e.summary,e.primary)})}):(console.log("Could not get calendar list"),appendOption("primary","Primary",!0))}